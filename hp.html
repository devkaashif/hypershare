<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemeMosaic - Collaborative Pixel Art</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #ff8e8e;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            padding: 20px;
        }

        .canvas-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #ffd166;
        }

        #pixelCanvas {
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            grid-template-rows: repeat(20, 1fr);
            gap: 2px;
            background: #ddd;
            border: 3px solid #333;
            margin: 0 auto;
            width: 500px;
            height: 500px;
        }

        .pixel {
            background: white;
            border: 1px solid #ccc;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pixel:hover {
            transform: scale(1.1);
            z-index: 1;
            position: relative;
        }

        .controls {
            background: #06d6a0;
            padding: 20px;
            border-radius: 15px;
            color: white;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border: 3px solid white;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: #333;
            transform: scale(1.1);
        }

        button {
            background: #118ab2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #0a6c8f;
            transform: translateY(-2px);
        }

        .user-info {
            background: #073b4c;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .online-users {
            margin-top: 20px;
        }

        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .user-badge {
            background: #ffd166;
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .meme-templates {
            margin-top: 20px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .template {
            background: #ef476f;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template:hover {
            background: #ff6b8b;
            transform: scale(1.05);
        }

        footer {
            background: #073b4c;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            #pixelCanvas {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ¨ MemeMosaic ðŸŽ¨</h1>
            <div class="subtitle">Collaborative Pixel Art for Meme Lovers!</div>
        </header>

        <div class="main-content">
            <div class="canvas-container">
                <div id="pixelCanvas"></div>
            </div>

            <div class="controls">
                <h3>ðŸŽ¨ Paint Tools</h3>
                <div class="color-palette">
                    <div class="color-option active" style="background: #ff6b6b;" data-color="#ff6b6b"></div>
                    <div class="color-option" style="background: #06d6a0;" data-color="#06d6a0"></div>
                    <div class="color-option" style="background: #118ab2;" data-color="#118ab2"></div>
                    <div class="color-option" style="background: #ffd166;" data-color="#ffd166"></div>
                    <div class="color-option" style="background: #ef476f;" data-color="#ef476f"></div>
                    <div class="color-option" style="background: #073b4c;" data-color="#073b4c"></div>
                    <div class="color-option" style="background: #ffffff;" data-color="#ffffff"></div>
                    <div class="color-option" style="background: #000000;" data-color="#000000"></div>
                </div>

                <button id="clearBtn">ðŸ§¹ Clear Canvas</button>
                <button id="saveBtn">ðŸ’¾ Save Artwork</button>

                <div class="meme-templates">
                    <h3>ðŸ“š Meme Templates</h3>
                    <div class="template-grid">
                        <div class="template" data-template="doge">Doge</div>
                        <div class="template" data-template="pepe">Pepe</div>
                        <div class="template" data-template="stonks">Stonks</div>
                        <div class="template" data-template="wojak">Wojak</div>
                    </div>
                </div>

                <div class="user-info">
                    <h3>ðŸ‘¥ Live Collaboration</h3>
                    <div id="userCount">Online: 1</div>
                    <div class="online-users">
                        <div class="user-list" id="userList">
                            <div class="user-badge">You</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Create amazing meme art together in real-time! Every pixel counts! ðŸš€</p>
        </footer>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD0T-mS__FlN3QASJnmD0K6S5VNDiN2bxQ",
            authDomain: "poplol-7209f.firebaseapp.com",
            projectId: "poplol-7209f",
            storageBucket: "poplol-7209f.firebasestorage.app",
            messagingSenderId: "1058108342269",
            appId: "1:1058108342269:web:577700a7503b3db8316394",
            measurementId: "G-EXR6CPBH5R"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Game state
        let currentColor = '#ff6b6b';
        let currentUser = null;
        let users = new Set();

        // DOM elements
        const pixelCanvas = document.getElementById('pixelCanvas');
        const colorOptions = document.querySelectorAll('.color-option');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');
        const userCount = document.getElementById('userCount');
        const userList = document.getElementById('userList');
        const templates = document.querySelectorAll('.template');

        // Initialize canvas
        function initializeCanvas() {
            pixelCanvas.innerHTML = '';
            for (let i = 0; i < 400; i++) {
                const pixel = document.createElement('div');
                pixel.className = 'pixel';
                pixel.dataset.index = i;
                
                pixel.addEventListener('click', () => {
                    updatePixel(i, currentColor);
                });
                
                pixelCanvas.appendChild(pixel);
            }
        }

        // Update pixel color
        function updatePixel(index, color) {
            const pixel = document.querySelector(`.pixel[data-index="${index}"]`);
            pixel.style.background = color;
            
            // Save to Firebase
            db.collection('canvas').doc(index.toString()).set({
                color: color,
                updatedBy: currentUser?.email || 'anonymous',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        // Load canvas from Firebase
        function loadCanvas() {
            db.collection('canvas').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' || change.type === 'modified') {
                        const data = change.doc.data();
                        const pixel = document.querySelector(`.pixel[data-index="${change.doc.id}"]`);
                        if (pixel) {
                            pixel.style.background = data.color;
                        }
                    }
                });
            });
        }

        // Color selection
        colorOptions.forEach(option => {
            option.addEventListener('click', () => {
                colorOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentColor = option.dataset.color;
            });
        });

        // Clear canvas
        clearBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear the entire canvas?')) {
                for (let i = 0; i < 400; i++) {
                    db.collection('canvas').doc(i.toString()).delete();
                }
            }
        });

        // Save artwork
        saveBtn.addEventListener('click', () => {
            alert('Artwork saved to cloud! Share with your friends! ðŸŽ‰');
        });

        // User management
        function setupUserSystem() {
            // Anonymous authentication
            auth.signInAnonymously().catch((error) => {
                console.error('Auth error:', error);
            });

            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    updateUserPresence();
                }
            });

            // Listen for other users
            db.collection('users').onSnapshot((snapshot) => {
                users.clear();
                userList.innerHTML = '';
                
                snapshot.forEach((doc) => {
                    users.add(doc.id);
                    if (doc.id !== currentUser?.uid) {
                        const userBadge = document.createElement('div');
                        userBadge.className = 'user-badge';
                        userBadge.textContent = `User${doc.id.slice(-4)}`;
                        userList.appendChild(userBadge);
                    }
                });
                
                // Add current user
                const youBadge = document.createElement('div');
                youBadge.className = 'user-badge';
                youBadge.textContent = 'You';
                userList.appendChild(youBadge);
                
                userCount.textContent = `Online: ${users.size}`;
            });
        }

        function updateUserPresence() {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            userRef.set({
                lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
                email: currentUser.email || 'anonymous'
            });
            
            // Remove user when they disconnect
            userRef.onDisconnect().delete();
        }

        // Meme templates
        templates.forEach(template => {
            template.addEventListener('click', () => {
                const templateName = template.dataset.template;
                loadMemeTemplate(templateName);
            });
        });

        function loadMemeTemplate(template) {
            // Simple template patterns (in a real app, these would be more complex)
            const templates = {
                doge: { colors: ['#ffd166', '#06d6a0', '#ef476f'], pattern: 'doge' },
                pepe: { colors: ['#06d6a0', '#073b4c', '#ffffff'], pattern: 'pepe' },
                stonks: { colors: ['#118ab2', '#ffd166', '#06d6a0'], pattern: 'stonks' },
                wojak: { colors: ['#ffd166', '#073b4c', '#ef476f'], pattern: 'wojak' }
            };
            
            alert(`Loading ${template} template! Start painting the meme! ðŸŽ¨`);
            // In a full implementation, this would apply actual pixel patterns
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeCanvas();
            loadCanvas();
            setupUserSystem();
            
            // Add some fun console messages
            console.log('ðŸŽ¨ MemeMosaic loaded! Ready to create some amazing art!');
            console.log('ðŸš€ Features: Real-time collaboration, meme templates, live user tracking');
        });
    </script>
</body>
</html>
